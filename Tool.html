<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="img/Tool.png" type="image/x-icon">
  <link rel="shortcut icon" href="img/Tool.png" type="image/x-icon">
  <title>小工具聚合站</title>
  <style>
    body { margin:0; padding:0; overflow:hidden; background:#000; }
    #fishCanvas{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:-1;}
    #toolSelector {
      flex: 1;
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    #toolSelector::-webkit-scrollbar { display: none; }
    #toolSelector button{margin:0 5px;padding:8px 10px;font-size:12px;cursor:pointer;border:none;border-radius:5px;background:#2b3432;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.5); flex: 0 0 18.5%; scroll-snap-align: start;transition: transform .3s ease, filter .3s ease; transform: scale(0.9); filter: brightness(0.7);} 
    #toolSelector button.focused {transform: scale(1.1); filter: brightness(1);}
    #toolSelector button.active{background:#537e74;}
    .tool-container{display:none;position:relative;z-index:10;padding:10px;}
    .tool-container.active{display:block;}
    #toolNav {
      position: relative;
      display: flex;
      align-items: center;
    }
    .nav-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-10%);
      width: 32px; height: 32px;
      border:none; background:rgba(0,0,0,0.6); color:#fff;
      cursor: pointer; border-radius:50%;
      z-index: 10;
    }
    #prevBtn { left: 4px; }
    #nextBtn { right: 4px; }
    .nav-arrow {
      position: relative;
      width: 36px;
      height: 36px;
      margin: 0 4px;
      background: rgba(0,0,0,0.5);
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
      transition: transform .15s ease, background .15s ease, box-shadow .15s ease;
    }    
    .nav-arrow svg {
      width: 20px;
      height: 20px;
    }
    .nav-arrow:hover {
      background: rgba(41,207,168,0.8);
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(0,0,0,0.5);
    }    
    .nav-arrow:active {
      transform: scale(0.95);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.6);
    }

    /*系統工具容器框架 時間管理工具樣式 */
    #timeTool,#morseTool,#binaryTool{
      width:45%; max-height:70vh; background:rgba(0,0,0,.7);
      margin:0 auto; padding:15px 20px; color:#fff;
      border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.6);
      font-family:sans-serif; overflow-y:auto;
      position:relative; display:flex; flex-direction:column;
      transform:none; margin-top:0;
    }
    #timeTool::before,#morseTool::before,#binaryTool::before{content:"";display:block;height:0;}
    #timeTool>h2,#morseTool>h2,#binaryTool>h2{
      margin:0 0 6px 0; font-size:13px; text-align:center;
      text-shadow:0 1px 3px rgba(0,0,0,.7); line-height:1.2;
    }
    #tool1Container, #tool2Container,#tool3Container{padding-top: 10px;} 

    /*卷軸樣式*/
    #timeTool,
    #eventsList,
    #binaryTool,
    #binaryTool textarea,
    #morseTool,
    #morseTool textarea,
    #codeTool,
    #exchangeTool,
    #exchangeTool input,
    #exchangeTool select {
      scrollbar-width: thin;
      scrollbar-color: #29cfa8 rgba(255,255,255,0.08);
    }
    #timeTool::-webkit-scrollbar,
    #eventsList::-webkit-scrollbar,
    #binaryTool::-webkit-scrollbar,
    #binaryTool textarea::-webkit-scrollbar,
    #morseTool::-webkit-scrollbar,
    #morseTool textarea::-webkit-scrollbar,
    #codeTool::-webkit-scrollbar,
    #exchangeTool::-webkit-scrollbar,
    #exchangeTool input::-webkit-scrollbar,
    #exchangeTool select::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    #timeTool::-webkit-scrollbar-track,
    #eventsList::-webkit-scrollbar-track,
    #binaryTool::-webkit-scrollbar-track,
    #binaryTool textarea::-webkit-scrollbar-track,
    #morseTool::-webkit-scrollbar-track,
    #morseTool textarea::-webkit-scrollbar-track,
    #codeTool::-webkit-scrollbar-track,
    #exchangeTool::-webkit-scrollbar-track,
    #exchangeTool input::-webkit-scrollbar-track,
    #exchangeTool select::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.08);
      border-radius: 4px;
    }
    #timeTool::-webkit-scrollbar-thumb,
    #eventsList::-webkit-scrollbar-thumb,
    #binaryTool::-webkit-scrollbar-thumb,
    #binaryTool textarea::-webkit-scrollbar-thumb,
    #morseTool::-webkit-scrollbar-thumb,
    #morseTool textarea::-webkit-scrollbar-thumb,
    #codeTool::-webkit-scrollbar-thumb,
    #exchangeTool::-webkit-scrollbar-thumb,
    #exchangeTool input::-webkit-scrollbar-thumb,
    #exchangeTool select::-webkit-scrollbar-thumb {
      background: #29cfa8;
      border-radius: 4px;
    }
    #timeTool::-webkit-scrollbar-thumb:hover,
    #eventsList::-webkit-scrollbar-thumb:hover,
    #binaryTool::-webkit-scrollbar-thumb:hover,
    #binaryTool textarea::-webkit-scrollbar-thumb:hover,
    #morseTool::-webkit-scrollbar-thumb:hover,
    #morseTool textarea::-webkit-scrollbar-thumb:hover,
    #codeTool::-webkit-scrollbar-thumb:hover,
    #exchangeTool::-webkit-scrollbar-thumb:hover,
    #exchangeTool input::-webkit-scrollbar-thumb:hover,
    #exchangeTool select::-webkit-scrollbar-thumb:hover {
      background: #1b6c5a;
    }

    /* 重整鍵 */
    #resetBtn{
      position:absolute !important;
      top:6px !important;
      right:6px !important;
      background:#00683c;
      border:none;
      color:#000;
      font-weight:bold;
      border-radius:8px;
      padding:6px 10px;
      cursor:pointer;
      box-shadow:0 2px 6px rgba(0,0,0,.5);
      margin:0 !important;
    }

    /* 模式選擇按鈕 */
    #modeSelector{display:flex;gap:10px;margin-bottom:15px;}
    .mode-btn{flex:1;padding:8px 0;border:1px solid rgba(255,255,255,.3);background:rgba(255,255,255,.1);color:#fff;border-radius:6px;cursor:pointer;font-size:12px;text-shadow:0 1px 2px rgba(0,0,0,.6);box-shadow:0 2px 4px rgba(0,0,0,.4);} 
    .mode-btn.active{background:#578d80;color:#fff;font-weight:bold;font-size:13px;}

    /* 時間輸入列 */
    .time-row{margin-bottom:10px;display:none;}
    .time-row label{display:block;font-size:12px;margin-bottom:4px;text-shadow:0 1px 2px rgba(0,0,0,.5);} 
    .time-row input[type="time"]{width:45%;padding:4px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.4);border-radius:4px;color:#fff;}
    .time-row input[type="time"]::-webkit-calendar-picker-indicator{filter:invert(1); opacity:1;}

    /* 控制按鈕容器 */
    #actionBtns{display:flex;gap:10px;justify-content:space-between;margin:10px 0;}
    #addEventBtn,#calculateBtn{flex:1;padding:8px 0;background:#03453b;border:none;color:#fff;font-weight:bold;border-radius:12px;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.5);} 
    #calculateBtn{background:#00683c;}

    #eventsList{max-height:300px;overflow-y:auto;margin-bottom:10px;}
    .event-item{display:flex;align-items:center;gap:6px;background:rgba(41,207,168,.3);padding:8px;margin:8px 0;border-radius:4px;box-shadow:0 2px 6px rgba(0,0,0,.5);flex-wrap:wrap;}
    .event-name{flex:0 0 35%;min-width:35%;padding:4px;background:transparent;border:1px solid rgba(255,255,255,.6);border-radius:3px;color:#fff;text-shadow:0 1px 1px rgba(0,0,0,.5);} 
    .event-name::placeholder{color:rgba(255,255,255,.5);} 
    .duration-group{display:flex;align-items:center;gap:4px;flex:0 0 auto;}
    .duration-group input{width:30px;padding:4px;background:transparent;border:1px solid rgba(255,255,255,.6);border-radius:3px;color:#fff;text-shadow:0 1px 1px rgba(0,0,0,.5);text-align:right;}
    .duration-group span{font-size:13px;color:#fff;text-shadow:0 1px 1px rgba(0,0,0,.5);} 
    .remove-btn{background:transparent;border:1px solid rgba(255,255,255,.6);color:#fff;padding:4px 8px;border-radius:3px;cursor:pointer;text-shadow:0 1px 1px rgba(0,0,0,.5);margin-left: auto;}  

    #result{margin-top:15px;font-weight:bold;text-align:center;text-shadow:0 1px 2px rgba(0,0,0,.7);} 

    /* 摩斯密碼工具樣式 */
    #morsePanels{display:flex;flex-direction:column;gap:14px;}
    #swapBtn,#swapBinBtn{align-self:center;padding:4px 26px;background:#216858;color:#fff;border:none;border-radius:8px;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.5);}
    .panel{background:rgba(41,207,168,.3);padding:12px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.5);}
    .panel label{display:block;font-size:12px;margin-bottom:6px;text-shadow:0 1px 2px rgba(0,0,0,.6);}
    .panel textarea{
      width:95%;height:50px;resize:vertical;padding:8px;
      background:rgba(0,0,0,.7);border:1px solid rgba(255,255,255,.3);
      border-radius:4px;color:#fff;font-family:monospace;font-size:12px;line-height:1.4;
    }
    .panel textarea::placeholder{color:rgba(255,255,255,.45);}
    .counter{margin-top:4px;font-size:12px;color:rgba(255,255,255,.8);text-align:right;}
    #morseActions{display:flex;gap:10px;justify-content:space-between;margin-top:12px;}
    #morseActions button{
      flex:1;padding:8px 0;background:#013836;border:none;color:#fff;font-weight:bold;
      border-radius:8px;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.5);
    }
    /* 二進制轉換工具樣式 */
    #binaryTool textarea{width:95%;height:50px;resize:vertical;padding:8px;background:rgba(0,0,0,.7);border:1px solid rgba(255,255,255,.4);border-radius:4px;color:#fff;font-family:monospace;font-size:14px;line-height:1.4;}
    #binaryTool textarea::placeholder{color:rgba(255,255,255,.45);}
    #binaryPanels{display:flex;flex-direction:column;gap:14px;}
    #binaryActions{display:flex;gap:10px;justify-content:space-between;margin-top:12px;}
    #binaryActions button{flex:1;padding:8px 0;background:#013836;border:none;color:#fff;font-weight:bold;border-radius:8px;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.5);}

    /* 匯率轉換工具樣式 */
    #exchangeTool {
      width: 45%;
      margin: 0 auto;
      padding: 15px 20px;
      background: rgba(0,0,0,0.7);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      color: #fff;
      display: flex;
      flex-direction: column;
      font-family: sans-serif;
    }
    #exchangeTool::before{ content:""; display:block; height:0; }
    #exchangeTool > h2{
      margin:0 0 6px 0 !important; font-size:13px; text-align:center;
      text-shadow:0 1px 3px rgba(0,0,0,.7); line-height:1.2;
    }
    #exchangeTool .panel{ margin-bottom:12px; }
    #exchangeTool label{display:block; font-size:14px; margin-bottom:6px; color:#fff;}
    #exchangeTool input,
    #exchangeTool select{
      width:80%; padding:8px; background:rgba(0,0,0,.7);
      border:1px solid rgba(255,255,255,.4); border-radius:4px;
      color:#fff; font-size:14px;
    }
    #exchangeActions{ display:flex; gap:10px; justify-content:space-between; margin:12px 0; }
    #exchangeActions button{
      flex:1; padding:8px 0; background:#013836; border:none;
      color:#fff; font-weight:bold; border-radius:8px;
      cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.5);
    }
    #exchangeResult{ margin-top:10px; font-size:16px; text-align:center; color:#29cfa8; }
    #exchangeTool .exchange-row {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }
    #exchangeTool .exchange-item {
      flex: 1;
    }
    #exchangeTool .exchange-item label {
      display: block;
      font-size: 12px;
      margin-bottom: 4px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    #exchangeTool .exchange-item select {
      width: 100%;
      padding: 6px;
      background: rgba(0,0,0,0.7);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
      appearance: none;
    }
    #exchangeResultWrapper {
      margin: 8px 0;
      padding: 10px;
      background: rgba(34,69,115,0.2);
      border-radius: 4px;
      min-height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #exchangeResult {
      font-size: 15px;
      color: #a2d3df;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0,0,0,0.7);
    }
    /* QR/條碼產生器 */
    #codeTool{
      width:45%; max-height:70vh; background:rgba(0,0,0,.7);
      margin:0 auto; padding:10px 20px; color:#fff;
      border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.6);
      font-family:sans-serif; overflow-y:auto;
      position:relative; display:flex; flex-direction:column;
      transform:none !important; margin-top:0 !important;
    }
    #codeTool::before{
      content:""; display:block; height:0;
    }
    #codeTool > h2{
      margin:0 0 12px 0; font-size:13px; text-align:center;
      text-shadow:0 1px 3px rgba(0,0,0,.7); line-height:1.2;
    }
    #codeSettings label{
      display:flex; flex-direction:column; font-size:12px; color:#fff;
    }
    #codeSettings input[type="text"],
    #codeSettings input[type="number"],
    #codeSettings input[type="color"],
    #codeSettings select{
      margin-top:4px; padding:6px; background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.4); border-radius:4px;
      color:#fff; font-size:13px;
    }
    #codeSettings{
      display:flex; flex-wrap:wrap; gap:12px;
    }
    #codeSettings label{ width:100%; }
    #codeSettings select{
      background:rgba(0,0,0,0.7) !important;
      color:#fff !important;
    }
    #codeSettings input[type="file"] { display: none; }
    #codeSettings label.file-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      background: rgba(12, 45, 51, 0.7);
      color: #fff;
      border: none;
      border-radius: 8px;
      box-shadow: 0 3px 0 rgba(0,0,0,.35), 0 6px 12px rgba(0,0,0,.45);
      cursor: pointer;
      transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
      position: relative;
      font-size: 13px;
    }
    #generateCodeBtn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      background: rgba(3, 92, 114, 0.7);
      color: #fff;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      box-shadow: 0 3px 0 rgba(0,0,0,.35), 0 6px 12px rgba(0,0,0,.45);
      cursor: pointer;
      transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
      position: relative;
      font-size: 14px;
    }
    #codeSettings label.file-btn::before {
      content: "\1F4E4";
      margin-right: 6px;
      font-size: 13px;
    }
    #codeSettings label.file-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 0 rgba(0,0,0,.4), 0 10px 18px rgba(0,0,0,.55);
      filter: brightness(1.08);
    }
    #codeSettings label.file-btn:active {
      transform: translateY(1px);
      box-shadow: inset 0 2px 4px rgba(0,0,0,.45), 0 2px 6px rgba(0,0,0,.4);
      filter: brightness(.95);
    }

    /* 單位換算器樣式 */
    #unitTool {
      width:45%; max-height:70vh; background:rgba(0,0,0,.7);
      margin:0 auto; padding:10px 20px; color:#fff;
      border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.6);
      font-family:sans-serif; display:flex; flex-direction:column;
      overflow-y:auto; position:relative;
    }
    #unitTool::before{content:"";display:block;height:0;}
    #unitTool>h2{
      margin:0 0 12px 0;font-size:13px;text-align:center;
      text-shadow:0 1px 3px rgba(0,0,0,.7);line-height:1.2;
    }
    .unit-row{
      display:flex; gap:12px; margin-bottom:12px;
    }
    .unit-row label{
      flex:1; display:flex; flex-direction:column;
      font-size:12px; color:#fff;
    }
    .unit-row select,
    .unit-row input[type="number"]{
      margin-top:4px; padding:6px;
      background:rgba(0,0,0,0.7);
      border:1px solid rgba(255,255,255,.4);
      border-radius:4px; color:#fff; font-size:13px;
      appearance:none;
    }
    #unitResultWrapper{
      margin:8px 0; padding:10px;
      background:rgba(34,69,115,0.35);
      border-radius:4px; min-height:36px;
      display:flex; align-items:center; justify-content:center;
    }
    #unitResult{
      font-size:14px; color:#29cfa8;
      text-shadow:0 1px 2px rgba(0,0,0,.7);
    }
    #unitActions{
      display:flex; gap:10px; margin-top:10px;
    }
    #unitActions button{
      flex:1; padding:8px 0; background:#013836;
      border:none; color:#fff; font-weight:bold;
      border-radius:8px; cursor:pointer;
      box-shadow:0 2px 6px rgba(0,0,0,.5);
      transition:transform .08s ease,
                 box-shadow .12s ease,
                 filter .12s ease;
    }

    /* 追加覆寫 */
    .time-row{display:flex;align-items:center;gap:8px;margin-bottom:10px;}
    .time-row label{margin:0;width:auto;}
    .time-output{margin-left:auto;font-size:12px;color:#29cfa8;font-weight:bold;text-shadow:0 1px 2px rgba(0,0,0,.7);} 
    
    /* 按鈕 */
    #generateCodeBtn,
    #downloadPngBtn,
    #downloadJpgBtn,
    #toolSelector button,
    .mode-btn,
    #addEventBtn,
    #calculateBtn,
    #resetBtn,
    #swapBtn{
      position: relative;
      transition: transform .08s ease, box-shadow .12s ease, filter .12s ease;
      box-shadow: 0 3px 0 rgba(0,0,0,.35), 0 6px 12px rgba(0,0,0,.45);
    }
    #generateCodeBtn:hover,
    #downloadPngBtn:hover,
    #downloadJpgBtn:hover,
    #toolSelector button:hover,
    .mode-btn:hover,
    #addEventBtn:hover,
    #calculateBtn:hover,
    #resetBtn:hover,
    #unitActions button:hover,
    #swapBtn:hover{
      transform: translateY(-2px);
      box-shadow: 0 5px 0 rgba(0,0,0,.4), 0 10px 18px rgba(0,0,0,.55);
      filter: brightness(1.08);
    }
    #generateCodeBtn:active,
    #downloadPngBtn:active,
    #downloadJpgBtn:active,
    #toolSelector button:active,
    .mode-btn:active,
    #addEventBtn:active,
    #calculateBtn:active,
    #unitActions button:active,
    #resetBtn:active,
    #swapBtn:active{
      transform: translateY(1px);
      box-shadow: inset 0 2px 4px rgba(0,0,0,.45), 0 2px 6px rgba(0,0,0,.4);
      filter: brightness(.95);
    }
    /* ==== 手機版調整（<= 768px）==== */
    @media (max-width:768px){
      body{overflow:auto;}
      #toolSelector{padding:15px 0}
      #toolSelector button{margin:0 3px;padding:11px 12px;font-size:13px;; flex: 0 0 22.5%;}
     
      #timeTool,#morseTool,#binaryTool,#codeTool,#exchangeTool,#unitTool{width:84vw;max-height:85vh;padding:16px 18px;transform:none;margin:10px auto;}
      /* 捲軸高度調整 */
      #eventsList{max-height:40vh;}

      .time-row{gap:6px;}
      .time-row input[type="time"]{width:45%;}
      .time-output{font-size:12px;}
      .mode-btn{font-size:13px;}
      .mode-btn.active{font-size:13px;}
      .panel textarea{width:100%;box-sizing:border-box;}
      .event-name{flex:0 0 22%;min-width:22%;}

      /* 摩斯工具 textarea 放大 */
      #morsePanels.panel textarea{width:100%;height:120px;}
      #swapBtn{padding:2px 22px;}
    }

    /* 極小螢幕（<=480px）*/
    @media (max-width:480px){
      #toolSelector button{font-size:10px;padding:7px 10px;}
      #timeTool,#morseTool{padding:14px 16px;}
      .mode-btn{font-size:12px;}
      .mode-btn.active{font-size:14px;}
      .duration-group input{width:50px;}
    }
  </style>
</head>
<body>
<body>
  <canvas id="fishCanvas"></canvas>
  <div id="toolNav">
    <button id="prevBtn" class="nav-arrow">
      <svg viewBox="0 0 24 24"><polyline points="15,18 9,12 15,6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <div id="toolSelector">
      <button id="tool1Btn" class="active">時間管理</button>
      <button id="tool2Btn">摩斯密碼</button>
      <button id="tool3Btn">轉二進制</button>
      <button id="tool4Btn">匯率轉換</button>
      <button id="tool5Btn">QR／條碼</button>
      <button id="tool6Btn">單位換算</button>
    </div>
    <button id="nextBtn" class="nav-arrow">
      <svg viewBox="0 0 24 24"><polyline points="9,18 15,12 9,6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
  </div>
  <!-- 時間管理工具 -->
  <div id="tool1Container" class="tool-container active">
    <div id="timeTool">
      <button id="resetBtn" title="重整">↻</button>
      <h2>時間管理工具</h2>
      <div id="modeSelector">
        <button class="mode-btn active" data-mode="arrive">何時到達</button>
        <button class="mode-btn" data-mode="depart">何時出發</button>
      </div>
      <div class="time-row" id="rowStart">
        <label>開始時間</label>
        <input type="time" id="startTime" />
        <span class="time-output" id="calcEndOut"></span>
      </div>
      <div class="time-row" id="rowTarget">
        <label>目標時間</label>
        <input type="time" id="targetTime" />
        <span class="time-output" id="calcDepartOut"></span>
      </div>
      <div id="eventsList"></div>
      <div id="actionBtns">
        <button id="addEventBtn">新增行程</button>
        <button id="calculateBtn">計算時間</button>
      </div>
      <div id="result"></div>
    </div>
  </div>

  <!-- 摩斯密碼翻譯器 -->
  <div id="tool2Container" class="tool-container">
    <div id="morseTool">
      <h2>摩斯密碼翻譯器</h2>
      <div id="morsePanels">
        <div class="panel">
          <label for="textInput">英文 / 文字輸入</label>
          <textarea id="textInput" placeholder="輸入英文、數字或符號..."></textarea>
          <div class="counter" id="textCount">0 字元</div>
        </div>
        <button id="swapBtn" title="交換上下內容">⇅ 交換</button>
        <div class="panel">
          <label for="morseInput">摩斯碼輸入（用 . - 和 / 或空白分隔）</label>
          <textarea id="morseInput" placeholder="例如：.... . .-.. .-.. --- / .-- --- .-. .-.. -.."></textarea>
          <div class="counter" id="morseCount">0 符號</div>
        </div>
      </div>
      <div id="morseActions">
        <button id="copyTextBtn">複製文字</button>
        <button id="copyMorseBtn">複製摩斯</button>
        <button id="clearAllBtn">清除</button>
      </div>
    </div>
  </div>

  <!-- 二進制轉換 -->
  <div id="tool3Container" class="tool-container">
    <div id="binaryTool">
      <h2>二進制轉換器</h2>
      <div id="binaryPanels">
        <div class="panel">
          <label for="decimalInput">十進制輸入</label>
          <textarea id="decimalInput" placeholder="輸入數字..."></textarea>
        </div>
        <button id="swapBinBtn">⇅ 交換</button>
        <div class="panel">
          <label for="binaryInput">二進制輸入</label>
          <textarea id="binaryInput" placeholder="輸入 0/1..."></textarea>
        </div>
      </div>
      <div id="binaryActions">
        <button id="copyDecBtn">複製十進制</button>
        <button id="copyBinBtn">複製二進制</button>
        <button id="clearBinBtn">清除</button>
      </div>
    </div>
  </div>

  <!-- 匯率轉換 -->
  <div id="tool4Container" class="tool-container">
    <div id="exchangeTool">
      <h2>匯率轉換器</h2>
      <div class="panel">
        <label for="amountInput">金額</label>
        <input type="number" id="amountInput" placeholder="輸入金額" min="0" step="any" />
      </div>
      <div class="exchange-row">
        <div class="exchange-item">
          <label for="baseCurrency">原幣別</label>
          <select id="baseCurrency"></select>
        </div>
        <div class="exchange-item">
          <label for="targetCurrency">目標幣別</label>
          <select id="targetCurrency"></select>
        </div>
      </div>
      <div id="exchangeResultWrapper">
        <span id="exchangeResult"></span>
      </div>
      <div id="exchangeActions">
        <button id="convertBtn">轉換</button>
        <button id="copyExchangeBtn">複製結果</button>
        <button id="clearExchangeBtn">清除</button>
      </div>
    </div>
  </div>
  <div id="tool5Container" class="tool-container">
    <div id="codeTool">
      <h2>QR／條碼產生器</h2>
      <div id="codeSettings">
        <label>模式
          <select id="codeType">
            <option value="qrcode">QR Code</option>
            <option value="barcode">條碼 (CODE128)</option>
          </select>
        </label>
        <label>文字／網址
          <input type="text" id="codeText" placeholder="輸入文字或網址" />
        </label>
        <label style="flex:0 0 20%;">
          尺寸 (px)
          <input type="number" id="codeSize" value="200" min="50" />
        </label>
        <label style="flex:0 0 8%;">
          前景色
          <input type="color" id="codeColor" value="#000000" />
        </label>
        <label style="flex:0 0 8%;">
          背景色
          <input type="color" id="codeBgColor" value="#ffffff" />
          </label>
        <label for="codeLogo" class="file-btn" style="flex:0 0 20%;"> 上傳 Logo</label>
        <input type="file" id="codeLogo" accept="image/*" style="display:none;" />
        <button id="generateCodeBtn" style="flex:0 0 20%;">生成</button>
      </div>
      <canvas id="codeCanvas" style="display:block;margin:0 auto 16px;"></canvas>
      <div id="downloadButtons" style="display:flex;gap:10px;justify-content:center;">
        <button id="downloadPngBtn" style="flex:1;padding:8px;border:none;border-radius:4px;background:#2F5C3B;color:#fff;cursor:pointer;">
          下載 PNG
        </button>
        <button id="downloadJpgBtn" style="flex:1;padding:8px;border:none;border-radius:4px;background:#2F5C3B;color:#fff;cursor:pointer;">
          下載 JPG
        </button>
      </div>
    </div>
  </div>
  <div id="tool6Container" class="tool-container">
    <div id="unitTool">
      <h2>單位換算</h2>
      <div class="unit-row">
        <label>
          類型
          <select id="unitCategory">
            <option value="distance">距離</option>
            <option value="weight">重量</option>
            <option value="volume">容積</option>
            <option value="area">面積</option>
            <option value="temperature">溫度</option>
            <option value="angle">角度</option>
          </select>
        </label>
        <label>
          從
          <select id="unitFrom"></select>
        </label>
        <label>
          到
          <select id="unitTo"></select>
        </label>
      </div>
      <div class="unit-row">
        <label>
          數值
          <input type="number" id="unitValue" placeholder="輸入數值" />
        </label>
      </div>
      <div id="unitResultWrapper">
        <span id="unitResult"></span>
      </div>
      <div id="unitActions">
        <button id="convertUnitBtn">轉換</button>
        <button id="clearUnitBtn">清除</button>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode/dist/JsBarcode.all.min.js"></script>
  <script>
    const fishCanvas = document.getElementById('fishCanvas');
    const fishCtx = fishCanvas.getContext('2d');
    let selectedHexagons = [];
    let hoveredHexagonsMap = {};
    let mouseX = -1, mouseY = -1;
    let time = 0;

    function resizeCanvas() {
      fishCanvas.width = window.innerWidth;
      fishCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function drawHexagon(ctx, cx, cy, r, style) {
      ctx.beginPath();
      for (let i = 0; i < 6; i++) {
        const ang = Math.PI / 3 * i - Math.PI / 6;
        const x = cx + r * Math.cos(ang);
        const y = cy + r * Math.sin(ang);
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      }
      ctx.closePath(); ctx.fillStyle = style; ctx.fill();
    }

    function drawGlow(ctx, x, y, r, op) {
      const g = ctx.createRadialGradient(x, y, r * 0.5, x, y, r);
      g.addColorStop(0, `rgba(190,250,255,${op * 0.8})`);
      g.addColorStop(1, `rgba(190,250,255,0)`);
      ctx.beginPath(); ctx.arc(x, y, r, 0, 2*Math.PI);
      ctx.fillStyle = g; ctx.fill();
    }

    function drawHexagonGrid(ctx, w, h, radius, t) {
      const hexW = 1.7 * radius;
      const hexH = Math.sqrt(3.1) * radius;
      
      for (let row = 0; row < h / (hexH * 0.8) + 1; row++) {
        const offsetX = (row % 2) * (hexW / 2);
        for (let col = 0; col < w / hexW + 1; col++) {
          const baseX = col * hexW + offsetX;
          const baseY = row * (hexH * 0.85);
          const waveX = Math.sin(baseX * 0.01 + t) * 3;
          const waveY = Math.cos(baseY * 0.01 + t) * 3;
          const x = baseX + waveX, y = baseY + waveY;
          let op = 0.08 + Math.sin(baseX * 0.01 + baseY * 0.01 + t) * 0.021;
          const bR = 70, bG = 220, bB = 255;
          let style = `rgba(${bR},${bG},${bB},${op})`;
          let glowOp = 0;
          let effR = radius;

          const dx = mouseX - x, dy = mouseY - y;
          const key = `${row}-${col}`;
          let isSelected = false;
          for (const hex of selectedHexagons) {
            if (hex.col === col && hex.row === row) {
              const e = (performance.now() - hex.startTime) / 1000;
              if (e < 1) {
                const m = e;
                style = `rgba(${70 + m * 120},${220 + m * 30},255,${op + m * (0.2 - op)})`;
                glowOp = m * 0.2;
              } else if (e < 2) {
                style = `rgba(190,250,255,0.2)`; glowOp = 0.2;
              } else if (e < 3) {
                const m = 1 - (e - 2);
                style = `rgba(${70 + m * 185},${220 + m * 35},255,${op + m * (0.2 - op)})`;
                glowOp = m * 0.2;
              }
              isSelected = true;
              break;
            }
          }
          if (Math.hypot(dx, dy) < radius * 1.2) {
            if (!hoveredHexagonsMap[key]) hoveredHexagonsMap[key] = { startTime: performance.now() };
          }
          if (!isSelected && hoveredHexagonsMap[key]) {
            const elapsed = performance.now() - hoveredHexagonsMap[key].startTime;
            const intensity = elapsed < 3000 ? 1 - (elapsed / 3000) : 0;
            const tR = bR + 0.1 * (255 - bR);
            const tG = bG + 0.1 * (255 - bG);
            const nR = Math.round(bR + intensity * (tR - bR));
            const nG = Math.round(bG + intensity * (tG - bG));
            style = `rgba(${nR},${nG},${bB},${op})`;
            effR = radius * (1 + 0.05 * intensity);
            glowOp = 0.1 * intensity;
          }

          if (glowOp > 0) drawGlow(ctx, x, y, radius * 1.5, glowOp);
          drawHexagon(ctx, x, y, effR, style);
        }
      }
      for (const k in hoveredHexagonsMap) {
        if ((performance.now() - hoveredHexagonsMap[k].startTime) / 1000 > 3) {
          delete hoveredHexagonsMap[k];
        }
      }
      selectedHexagons = selectedHexagons.filter(h => (performance.now() - h.startTime) / 1000 < 3);
    }
    function animateBackground() {
      time += 0.02;
      fishCtx.clearRect(0, 0, fishCanvas.width, fishCanvas.height);
      drawHexagonGrid(fishCtx, fishCanvas.width, fishCanvas.height, 45, time);
      requestAnimationFrame(animateBackground);
    }
    function randomSelectHexagon() {
      const cols = Math.ceil(fishCanvas.width / (1.7 * 45));
      const rows = Math.ceil(fishCanvas.height / (Math.sqrt(3.1) * 45));
      selectedHexagons.push({ col: Math.floor(Math.random() * cols), row: Math.floor(Math.random() * rows), startTime: performance.now() });
      setTimeout(randomSelectHexagon, 1000);
    }
    function handleMouseMove(e){
      const rect = fishCanvas.getBoundingClientRect();
      mouseX = e.clientX - rect.left;
      mouseY = e.clientY - rect.top;
    }
    function handleMouseLeave(){
      mouseX = -1;
      mouseY = -1;
    }
    window.addEventListener('mousemove', handleMouseMove, { passive: true });
    window.addEventListener('mouseleave', handleMouseLeave);
    window.addEventListener('touchmove', e => {
      if (e.touches && e.touches[0]) handleMouseMove(e.touches[0]);
    }, { passive: true });

    /* ===== 時間管理工具邏輯 ===== */
    const events = [];
    const eventsList = document.getElementById('eventsList');
    const startInput = document.getElementById('startTime');
    const targetInput = document.getElementById('targetTime');
    const resultDiv = document.getElementById('result');
    const modeButtons = document.querySelectorAll('.mode-btn');
    const rowStart = document.getElementById('rowStart');
    const rowTarget = document.getElementById('rowTarget');
    const labelStart = rowStart.querySelector('label');
    const labelTarget = rowTarget.querySelector('label');
    const calcEndOut = document.getElementById('calcEndOut');
    const calcDepartOut = document.getElementById('calcDepartOut');
    let mode = 'arrive';

    function setMode(m){
      mode = m;
      modeButtons.forEach(btn=>btn.classList.toggle('active', btn.dataset.mode===m));
      if(m==='arrive'){
        rowTarget.style.display='block';
        rowStart.style.display='none';
        labelTarget.textContent='輸入行程目標時間';
        startInput.value='';
      }else{
        rowStart.style.display='block';
        rowTarget.style.display='none';
        labelStart.textContent='輸入行程起始時間';
        targetInput.value='';
      }
      calcEndOut.textContent='';
      calcDepartOut.textContent='';
      resultDiv.textContent='';
    }
    setMode(mode);
    modeButtons.forEach(btn=>btn.addEventListener('click',()=>setMode(btn.dataset.mode)));

    document.getElementById('addEventBtn').addEventListener('click',()=>{
      events.push({name:'',hours:0,mins:0});
      renderEvents();
    });
    function attachAutoPicker(el) {
      ['focus', 'click'].forEach(ev => {
        el.addEventListener(ev, () => {
          if (typeof el.showPicker === 'function') el.showPicker();
        });
      });
    }
    document.querySelectorAll('.time-row input[type="time"]').forEach(attachAutoPicker);

    function renderEvents(){
      eventsList.innerHTML='';
      events.forEach((e,i)=>{
        const div=document.createElement('div');
        div.className='event-item';
        div.innerHTML=`<input class="event-name" type="text" placeholder="行程名稱" value="${e.name}" data-i="${i}" data-f="name">
          <div class=\"duration-group\">
            <input type=\"number\" min=\"0\" value=\"${e.hours}\" data-i=\"${i}\" data-f=\"hours\"><span>小時</span>
            <input type=\"number\" min=\"0\" max=\"59\" value=\"${e.mins}\" data-i=\"${i}\" data-f=\"mins\"><span>分鐘</span>
          </div>
          <button class=\"remove-btn\" data-rm=\"${i}\">刪除</button>`;
        eventsList.appendChild(div);
      });
    }

    eventsList.addEventListener('input',e=>{
      const i=e.target.getAttribute('data-i');
      const f=e.target.getAttribute('data-f');
      if(i!==null && f){
        events[i][f]=f==='name'?e.target.value:parseInt(e.target.value)||0;
      }
    });

    eventsList.addEventListener('click',e=>{
      if(e.target.dataset.rm!==undefined){
        const idx=parseInt(e.target.dataset.rm);
        events.splice(idx,1);renderEvents();
      }
    });

    document.getElementById('calculateBtn').addEventListener('click',()=>{

      calcEndOut.textContent='';
      calcDepartOut.textContent='';
      resultDiv.textContent='';
      const totalMins = events.reduce((s,e)=>s+e.hours*60+e.mins,0);
      if(mode==='depart'){
        if(!startInput.value){resultDiv.textContent='請輸入起始(出發)時間';return;}
        const start=parseTime(startInput.value);
        const endRaw=addMinutes(start,totalMins);
        calcEndOut.textContent = '→ ' + formatWithDays(endRaw,'forward');
      }else{
        if(!targetInput.value){resultDiv.textContent='請輸入抵達(目標)時間';return;}
        const target=parseTime(targetInput.value);
        const departRaw=addMinutes(target,-totalMins);
        calcDepartOut.textContent = '→ ' + formatWithDays(departRaw,'backward');
      }
    });

    document.getElementById('resetBtn').addEventListener('click',()=>{
      if(confirm('確定要清空所有資料並回到模式選擇？')){
        events.length=0;
        startInput.value='';
        targetInput.value='';
        renderEvents();
        setMode('arrive');
        resultDiv.textContent='';
      }
    });

    function parseTime(str){const [h,m]=str.split(':').map(n=>parseInt(n,10));return h*60+m;}
    function formatTime(mins){mins=(mins+24*60)%(24*60);const h=Math.floor(mins/60).toString().padStart(2,'0');const m=(mins%60).toString().padStart(2,'0');return `${h}:${m}`;}
    function addMinutes(base,delta){return base+delta;}
    const DAY_MIN=1440;
    function formatWithDays(rawMins, type){
      // type: 'forward' => 結束/抵達 ; 'backward' => 出發
      if(type==='forward'){
        const days=Math.floor(rawMins/DAY_MIN);
        if(days>0){return `抵達時間：隔${days}天的 ${formatTime(rawMins)}`;}
        return `最終抵達時間：${formatTime(rawMins)}`;
      }else{ // backward
        if(rawMins<0){
          const daysBefore=Math.ceil(Math.abs(rawMins)/DAY_MIN);
          const norm=((rawMins % DAY_MIN)+DAY_MIN)%DAY_MIN;
          return `出發時間：前${daysBefore}天的 ${formatTime(norm)}`;
        }
        return `行程出發時間：${formatTime(rawMins)}`;
      }
    }
  
    // ===== 摩斯密碼翻譯器 =====
    const textInput     = document.getElementById('textInput');
    const morseInput    = document.getElementById('morseInput');
    const textCount     = document.getElementById('textCount');
    const morseCount    = document.getElementById('morseCount');
    const copyTextBtn   = document.getElementById('copyTextBtn');
    const copyMorseBtn  = document.getElementById('copyMorseBtn');
    const clearAllBtn   = document.getElementById('clearAllBtn');
    const swapBtn       = document.getElementById('swapBtn');

    const TEXT_TO_MORSE = {
      "A":".-","B":"-...","C":"-.-.","D":"-..","E":".","F":"..-.","G":"--.","H":"....","I":"..","J":".---",
      "K":"-.-","L":".-..","M":"--","N":"-.","O":"---","P":".--.","Q":"--.-","R":".-.","S":"...","T":"-",
      "U":"..-","V":"...-","W":".--","X":"-..-","Y":"-.--","Z":"--..",
      "0":"-----","1":".----","2":"..---","3":"...--","4":"....-","5":".....","6":"-....","7":"--...","8":"---..","9":"----.",
      ".":".-.-.-",",":"--..--","?":"..--..","!":"-.-.--",":":"---...",";":"-.-.-.","/":"-..-.","-":"-....-","(":"-.--.",")":"-.--.-",
      "\"":".-..-.","'":".----.","=":"-...-","+":".-.-.","@":".--.-.","&":".-...","¿":"..-.-","¡":"--...-"
    };
    const MORSE_TO_TEXT = Object.fromEntries(Object.entries(TEXT_TO_MORSE).map(([k,v])=>[v,k]));

    let lock = false;
    function getMorseTokens(str){
      return str.trim()
                .replace(/\n+/g,' ')
                .split(/(?:\s+|\/|\|)+/g) 
                .filter(Boolean);
    }
    function updateCounts(){
      if(textCount)  textCount.textContent  = [...(textInput?.value||'')].length + ' 字元';
      if(morseCount) morseCount.textContent = getMorseTokens(morseInput?.value||'').length + ' 符號';
    }
    function textToMorse(str){
      return str.toUpperCase().split('').map(ch=>{
        if(ch===' ') return '/';
        return TEXT_TO_MORSE[ch] || '';
      }).filter(Boolean).join(' ');
    }
    function morseToText(str){
      const tokens = getMorseTokens(str);
      return tokens.map(code=>{
        if(code==='/'||code==='|') return ' ';
        return MORSE_TO_TEXT[code] || '';
      }).join('').replace(/\s+/g,' ');
    }
    if(textInput){
      textInput.addEventListener('input', ()=>{
        if(lock) return; lock = true;
        morseInput.value = textToMorse(textInput.value);
        updateCounts(); lock = false;
      });
    }
    if(morseInput){
      morseInput.addEventListener('input', ()=>{
        if(lock) return; lock = true;
        textInput.value = morseToText(morseInput.value);
        updateCounts(); lock = false;
      });
    }
    copyTextBtn?.addEventListener('click', ()=> navigator.clipboard?.writeText(textInput.value));
    copyMorseBtn?.addEventListener('click',()=> navigator.clipboard?.writeText(morseInput.value));
    clearAllBtn?.addEventListener('click', ()=>{
      textInput.value=''; morseInput.value=''; updateCounts();
    });
    swapBtn?.addEventListener('click', ()=>{
      const t = textInput.value;
      textInput.value  = morseToText(morseInput.value);
      morseInput.value = textToMorse(t);
      updateCounts();
    });
    updateCounts();

    // 二進制轉換邏輯
    const decIn = document.getElementById('decimalInput');
    const binIn = document.getElementById('binaryInput');
    const copyDecBtn = document.getElementById('copyDecBtn');
    const copyBinBtn = document.getElementById('copyBinBtn');
    const clearBinBtn = document.getElementById('clearBinBtn');
    const swapBinBtn = document.getElementById('swapBinBtn');
    let lockBin = false;
    function updateBinary() {
      if (lockBin) return;
      lockBin = true;
      let d = decIn.value.trim().replace(/,/g, ''); // 允許逗號
      if (d === '') {
        binIn.value = '';
        lockBin = false;
        return;
      }
      // 處理小數點
      const parts = d.split('.');
      const intNum = parseInt(parts[0], 10);//最多處理小數點後兩位
      const intBin = isNaN(intNum) ? '' : intNum.toString(2);
      let fracBin = '';
      if (parts[1] !== undefined) {
        let frac = parseFloat('0.' + parts[1]);
        let count = 0;
        while (frac > 0 && count < 10) { 
          frac *= 2;
          if (frac >= 1) {
            fracBin += '1';
            frac -= 1;
          } else {
            fracBin += '0';
          }
          count++;
        }
      }
      binIn.value = fracBin ? `${intBin}.${fracBin}` : intBin;
      lockBin = false;
    }

    function updateDecimal() {
      if (lockBin) return;
      lockBin = true;
      const raw = binIn.value.trim();
      if (raw === '') {
        decIn.value = '';
      } else {
        const parts = raw.split(/([,\.\/])/);
        const result = parts.map(part => {
          if (/^[,\.\/]$/.test(part)) {
            return part; // 保留分隔符
          }
        const b = part.replace(/[^01]/g, '');
          if (b === '') return '';
          const n = parseInt(b, 2);
          return isNaN(n) ? '' : n.toString(10);
        }).join('');
        decIn.value = result;
      }
      lockBin = false;
    }
    decIn.addEventListener('input', updateBinary);
    binIn.addEventListener('input', updateDecimal);
    copyDecBtn.addEventListener('click', () => navigator.clipboard?.writeText(decIn.value));
    copyBinBtn.addEventListener('click', () => navigator.clipboard?.writeText(binIn.value));
    clearBinBtn.addEventListener('click', () => { decIn.value = ''; binIn.value = ''; });
    swapBinBtn.addEventListener('click', () => {
      const t = decIn.value;
      decIn.value = binIn.value;
      binIn.value = t;
      updateBinary();
    });

// ===== 匯率轉換邏輯 =====
document.addEventListener('DOMContentLoaded', () => {
  const amountInput      = document.getElementById('amountInput');
  const baseCurrency     = document.getElementById('baseCurrency');
  const targetCurrency   = document.getElementById('targetCurrency');
  const convertBtn       = document.getElementById('convertBtn');
  const copyExchangeBtn  = document.getElementById('copyExchangeBtn');
  const clearExchangeBtn = document.getElementById('clearExchangeBtn');
  const exchangeResult   = document.getElementById('exchangeResult');

  const CODES = ['TWD','USD','EUR','JPY','CNY','HKD','SGD','AUD','GBP','CAD','KRW','THB','RUB'];
  const NAMES = {
    TWD:'新台幣',USD:'美金',EUR:'歐元',JPY:'日幣',CNY:'人民幣',HKD:'港幣',
    SGD:'新加坡幣',AUD:'澳幣',GBP:'英鎊',CAD:'加拿大幣',KRW:'韓元',THB:'泰銖',RUB:'盧布'
  };
  const ratesCache = {};
  CODES.forEach(code => {
    const label = `${code} – ${NAMES[code]}`;
    baseCurrency .add(new Option(label, code));
    targetCurrency.add(new Option(label, code));
  });
  baseCurrency.value   = 'TWD';
  targetCurrency.value = 'USD';
  async function fetchRates() {
    try {
      const res = await fetch('https://open.er-api.com/v6/latest/TWD');
      const data = await res.json();
      if (data.result !== 'success' || typeof data.rates !== 'object') {
        throw new Error('Invalid API response');
      }
      CODES.forEach(code => {
        ratesCache[code] = data.rates[code] ?? null;
      });
    } catch (err) {
      console.error('取得匯率失敗，使用 fallback', err);
      CODES.forEach(code => {
        ratesCache[code] = (code === 'TWD' || code === 'USD') ? 1 : null;
      });
    }
  }

  function convertExchange() {
    const amt  = parseFloat(amountInput.value);
    const from = baseCurrency.value;
    const to   = targetCurrency.value;
    if (isNaN(amt) || ratesCache[from] == null || ratesCache[to] == null) {
      exchangeResult.textContent = '請輸入金額並等待匯率載入';
      return;
    }
    const result = amt * (ratesCache[to] / ratesCache[from]);
    exchangeResult.textContent = `${amt} ${from} = ${result.toFixed(4)} ${to}`;
  }

  fetchRates();
  convertBtn    .addEventListener('click', convertExchange);
  copyExchangeBtn.addEventListener('click', () => {
    if (exchangeResult.textContent)
      navigator.clipboard.writeText(exchangeResult.textContent);
  });
  clearExchangeBtn.addEventListener('click', () => {
    amountInput.value = '';
    exchangeResult.textContent = '';
  });
});

  //======QR/條碼邏輯=========
  const codeType      = document.getElementById('codeType');
  const codeText      = document.getElementById('codeText');
  const codeSize      = document.getElementById('codeSize');
  const codeColor     = document.getElementById('codeColor');
  const codeBgColor   = document.getElementById('codeBgColor');
  const codeLogoInput = document.getElementById('codeLogo');
  const generateBtn   = document.getElementById('generateCodeBtn');
  const canvas        = document.getElementById('codeCanvas');
  const downloadPng   = document.getElementById('downloadPngBtn');
  const downloadJpg   = document.getElementById('downloadJpgBtn');
  const ctx           = canvas.getContext('2d');
  let logoImg         = new Image();

  codeLogoInput.addEventListener('change', () => {
    const file = codeLogoInput.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => logoImg.src = e.target.result;
    reader.readAsDataURL(file);
  });

  async function drawCode() {
    const text = codeText.value.trim();
    if (!text) return;
    const size = Math.max(50, parseInt(codeSize.value, 10) || 200);
    if (codeType.value === 'qrcode') {
      canvas.width = canvas.height = size;
      ctx.fillStyle = codeBgColor.value;
      ctx.fillRect(0, 0, size, size);
      await QRCode.toCanvas(canvas, text, {
        width: size,
        margin: 1,
        color: { dark: codeColor.value, light: codeBgColor.value }
      });
      if (logoImg.src) {
        const lw     = size * 0.2;   
        const margin = 5;        
        const lx     = (size - lw) / 2;   
        const ly     = (size - lw) / 2;  
        ctx.fillStyle = codeBgColor.value;
        ctx.fillRect(
          lx - margin,
          ly - margin,
          lw + margin * 2,
          lw + margin * 2
        );
        ctx.drawImage(logoImg, lx, ly, lw, lw);
      }
      } else {
        const w = size;
        const h = size * 0.5;
        canvas.width = w;
        canvas.height = h;
        ctx.fillStyle = codeBgColor.value;
        ctx.fillRect(0, 0, w, h);
        const modules = text.length * 11;
        const barWidth = Math.max(1, Math.floor(w / modules));
        JsBarcode(canvas, text, {
          format: 'CODE128',
          width: barWidth,
          height: h * 0.8,
          displayValue: false,
          lineColor: codeColor.value,
          background: codeBgColor.value
      });
    }
  }
  generateBtn.addEventListener('click', drawCode);
  downloadPng.addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'code.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  });
  downloadJpg.addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'code.jpg';
    link.href = canvas.toDataURL('image/jpeg', 0.8);
    link.click();
  });

  // 單位轉換參數表
  const maps = {
    distance:   { m: 1, cm: 0.01, mm: 0.001, um: 1e-6, km: 1000, mi: 1609.34, ft: 0.3048 },
    weight:     { g:1,    kg:1000,   lb:453.592, oz:28.3495, jin:600 },
    volume:     { L:1,    mL:0.001,  gal:3.78541, qt:0.946353 },
    temperature:{ C:1,    F:1,       K:1 }, 
    area:       { m2:1,   km2:1e6,   ha:10000,   ac:4046.86, ft2:0.092903, in2:0.00064516 },
    angle:      { deg: 1, rad: Math.PI / 180, grad: 0.9, amin: 1 / 60, asec: 1 / 3600 }
  };
  const labels = {
    distance:   { m: '公尺', cm:'公分', mm:'毫米', um:'微米', km:'公里', mi:'英里', ft:'英尺' },
    weight:     { g:'克',       kg:'公斤',      lb:'磅',       oz:'盎司', jin:'台斤' },
    volume:     { L:'公升',     mL:'毫升',      gal:'加侖',     qt:'夸脫' },
    temperature:{ C:'攝氏度',   F:'華氏度',    K:'開氏度' },
    area:       { m2:'平方公尺', km2:'平方公里', ha:'公頃',     ac:'英畝',     ft2:'平方英尺', in2:'平方英吋' },
    angle:      { deg:  '度', rad:  '弧度',  grad: '梯度',  amin: '分角',  asec: '秒角' }
  };

  const catSel   = document.getElementById('unitCategory');
  const fromSel  = document.getElementById('unitFrom');
  const toSel    = document.getElementById('unitTo');
  const valInput = document.getElementById('unitValue');
  const resultEl = document.getElementById('unitResult');

  function populateUnits() {
    const cat = catSel.value;
    fromSel.innerHTML = '';
    toSel.innerHTML   = '';
    Object.entries(labels[cat]).forEach(([code,name]) => {
      const label = `${code} – ${name}`;
      fromSel.add(new Option(label, code));
      toSel  .add(new Option(label, code));
    });
  }

  catSel.addEventListener('change', populateUnits);
  populateUnits();

  const suffixMap = {
    distance: {
      m:  'm',
      cm: 'cm',
      mm: 'mm',
      um: 'µm',
      km: 'km',
      mi: 'mi',
      ft: 'ft'
    },
    weight: {
      g:   'g',
      kg:  'kg',
      lb:  'lb',
      oz:  'oz',
      jin: '台斤'
    },
    volume: {
      L:   'L',
      mL:  'mL',
      gal: 'gal',
      qt:  'qt'
    },
    temperature: {
      C: '°C',
      F: '°F',
      K: 'K'
    },
    area: {
      m2:  'm²',
      km2: 'km²',
      ha:  'ha',
      ac:  'ac',
      ft2: 'ft²',
      in2: 'in²'
    },
    angle: {
      deg:  '°',
      rad:  'rad',
      grad: 'grad',
      amin: '′',
      asec: '″'
    }
  };

  document.getElementById('convertUnitBtn').addEventListener('click', () => {
    const cat  = catSel.value;
    const from = fromSel.value;
    const to   = toSel.value;
    const v    = parseFloat(valInput.value);
    if (isNaN(v)) {
      resultEl.textContent = '請輸入數值';
      return;
    }
    let r;
    if (cat === 'temperature') {
      let c = from === 'C' ? v
            : from === 'F' ? (v - 32) * 5/9
            : (v - 273.15);
      r = to === 'C' ? c
        : to === 'F' ? c * 9/5 + 32
        : c + 273.15;
    } else {
      r = v * maps[cat][from] / maps[cat][to];
    }
    const suffix = (suffixMap[cat] && suffixMap[cat][to])
      ? suffixMap[cat][to]
      : to;
    resultEl.textContent = `${r.toFixed(4)}${suffix}`;
  });

  document.getElementById('clearUnitBtn').addEventListener('click', () => {
    valInput.value = '';
    resultEl.textContent = '';
  });
  
  /* === 小工具列邏輯 === */
  const tabBtns = Array.from(document.querySelectorAll('#toolSelector button'));
  const containers = tabBtns.map(b =>
    document.getElementById(b.id.replace('Btn','Container'))
  );
  tabBtns.forEach((btn,i) => {
    btn.addEventListener('click', () => {
      tabBtns.forEach((b,j) => b.classList.toggle('active', i===j));
      containers.forEach((c,j) => c.classList.toggle('active', i===j));
    });
  });

  const scroller   = document.getElementById('toolSelector');
  const scrollBtns = Array.from(scroller.querySelectorAll('button'));
  let itemWidth = scrollBtns[0]?.offsetWidth || 0;
  window.addEventListener('resize', () => {
    itemWidth = scrollBtns[0].offsetWidth;
  });

  let currentIndex = 0;
  const total = scrollBtns.length;

  function updateFocus() {
    scrollBtns.forEach((btn, i) =>
      btn.classList.toggle('focused', i === currentIndex)
    );
  }

  function scrollToIndex(idx) {
    currentIndex = Math.max(0, Math.min(total - 1, idx));
    scrollBtns[currentIndex].scrollIntoView({
      behavior: 'smooth',
      inline: 'center',
      block: 'nearest'
    });
    updateFocus();
  }

  document.getElementById('prevBtn').addEventListener('click', () => {
    scrollToIndex(currentIndex - 1);
  });
  document.getElementById('nextBtn').addEventListener('click', () => {
    scrollToIndex(currentIndex + 1);
  });

  updateFocus();

    randomSelectHexagon();
    animateBackground();
  </script>
</body>
</html>
